<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Criar Conta - MedDoc</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body class="login-page">
<div class="form-container">
    <div class="form-box">
        <div class="logo"></div>
        <h2>Criar Conta</h2>
        <p class="subtitle">Preencha seus dados para se cadastrar no MedDoc</p>

        <form id="cadastroWizard" th:action="@{/cadastro}" method="post" th:object="${usuario}">
            <!-- Etapa 1: Dados Básicos -->
            <div class="wizard-step" id="step-1">
                <select th:field="*{tipoUsuario}" required>
                    <option value="" disabled selected>Selecione o tipo de usuário</option>
                    <option value="IDOSO">Idoso</option>
                    <option value="MEDICO">Médico</option>

                </select>

                <input type="text" th:field="*{nome}" placeholder="Nome Completo" required>
                <input type="text" th:field="*{cpf}" placeholder="CPF" required>
                <input type="email" th:field="*{email}" placeholder="Email" required>
                <input type="text" th:field="*{celular}" placeholder="Celular" required>

                <!-- Novo campo CRM, visível apenas para Médicos -->
                <div id="crm-field" style="display:none;">
                    <input type="text" th:field="*{crm}" placeholder="CRM" pattern="[0-9]{6}" title="O CRM deve conter 6 dígitos">
                </div>

                <button type="button" class="wizard-btn-proximo" onclick="nextStep(2)">Prosseguir<i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
            <!-- Etapa 2: Endereço -->
            <div class="wizard-step" id="step-2" style="display:none;">
                <input type="text" th:field="*{endereco}" placeholder="Endereço" required>
                <input type="text" th:field="*{numero}" placeholder="Número" required>
                <input type="text" th:field="*{bairro}" placeholder="Bairro" required>
                <input type="text" th:field="*{cidade}" placeholder="Cidade" required>
                <button type="button" onclick="prevStep(1)">Voltar</button>
                <button type="button" onclick="nextStep(3)">Próximo</button>
            </div>
            <!-- Etapa 3: Informações Médicas -->
            <div class="wizard-step" id="step-3" style="display:none;">
                <select th:field="*{tipoSanguineo}" required>
                    <option value="" disabled selected>Tipo Sanguíneo</option>
                    <option value="A_POSITIVO">A+</option>
                    <option value="A_NEGATIVO">A-</option>
                    <option value="B_POSITIVO">B+</option>
                    <option value="B_NEGATIVO">B-</option>
                    <option value="AB_POSITIVO">AB+</option>
                    <option value="AB_NEGATIVO">AB-</option>
                    <option value="O_POSITIVO">O+</option>
                    <option value="O_NEGATIVO">O-</option>
                </select>
                <textarea th:field="*{alergias}" placeholder="Alergias (separe por vírgula)" rows="2"></textarea>
                <textarea th:field="*{condicoesCronicas}" placeholder="Condições Crônicas (separe por vírgula)" rows="2"></textarea>
                <textarea th:field="*{medicamentosRegulares}" placeholder="Medicamentos Regulares (separe por vírgula)" rows="2"></textarea>
                <button type="button" onclick="prevStep(2)">Voltar</button>
                <button type="button" onclick="nextStep(4)">Próximo</button>
            </div>
            <!-- Etapa 4: Contato de Emergência -->
            <div class="wizard-step" id="step-4" style="display:none;">
                <input type="text" th:field="*{nomeparentescoEmergencia}" placeholder="Nome do parente">
                <input type="text" th:field="*{telefoneEmergencia}" placeholder="Telefone de Emergência">
                <input type="text" th:field="*{parentescoEmergencia}" placeholder="Parentesco do Contato de Emergência">
                <button type="button" onclick="prevStep(3)">Voltar</button>
                <button type="button" onclick="nextStep(5)">Próximo</button>
            </div>
            <!-- Etapa 5: Senha -->
            <div class="wizard-step" id="step-5" style="display:none;">
                <input type="password" th:field="*{senha}" placeholder="Senha" required>
                <input type="password" th:field="*{confirmarSenha}" placeholder="Confirmar Senha" required>
                <span>Data de Nascimento</span>
                <input type="date" th:field="*{dataNascimento}" placeholder="Data de Nascimento" required>
                <button type="button" onclick="prevStep(4)">Voltar</button>
                <button type="submit">Criar Conta</button>
            </div>
        </form>
        <p class="switch-form">Já tem uma conta? <a th:href="@{/login}">Faça login</a></p>
    </div>
</div>

<script>

function nextStep(step) {
    const tipoUsuario = document.querySelector('select[name="tipoUsuario"]').value;
    if (tipoUsuario === 'MEDICO') {
        if (step === 3) { // Se for médico e tentar ir para Etapa 3, pula para Etapa 5
            document.querySelectorAll('.wizard-step').forEach(div => div.style.display = 'none');
            document.getElementById('step-5').style.display = '';
            return;
        } else if (step === 4) { // Se for médico e tentar ir para Etapa 4, pula para Etapa 5
            document.querySelectorAll('.wizard-step').forEach(div => div.style.display = 'none');
            document.getElementById('step-5').style.display = '';
            return;
        }
    }
    document.querySelectorAll('.wizard-step').forEach(div => div.style.display = 'none');
    document.getElementById('step-' + step).style.display = '';
}
function prevStep(step) {
    const tipoUsuario = document.querySelector('select[name="tipoUsuario"]').value;
    if (tipoUsuario === 'MEDICO' && step === 4) { // Se for médico e tentar voltar da Etapa 5 para a Etapa 4, volta para a Etapa 2
        document.querySelectorAll('.wizard-step').forEach(div => div.style.display = 'none');
        document.getElementById('step-2').style.display = '';
        return;
    }
    document.querySelectorAll('.wizard-step').forEach(div => div.style.display = 'none');
    document.getElementById('step-' + step).style.display = '';
}

// Adicionar lógica para mostrar/esconder o campo CRM
document.addEventListener('DOMContentLoaded', function() {
    const tipoUsuarioSelect = document.querySelector('select[name="tipoUsuario"]');
    const crmField = document.getElementById('crm-field');

    function toggleCrmField() {
        if (tipoUsuarioSelect.value === 'MEDICO') {
            crmField.style.display = 'block';
            crmField.querySelector('input').setAttribute('required', 'required');
        } else {
            crmField.style.display = 'none';
            crmField.querySelector('input').removeAttribute('required');
            crmField.querySelector('input').value = ''; // Limpar o campo quando escondido
        }
    }

    // Chamar a função no carregamento da página e na mudança de seleção
    toggleCrmField();
    tipoUsuarioSelect.addEventListener('change', toggleCrmField);
});

</script>



</body>
</html>